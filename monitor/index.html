<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Cache stats</title>

    <script type="text/javascript" src="/js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="/js/highcharts.js"></script>
    <!-- contains the main chart for xebia counter -->
    <script type="text/javascript" src="/js/xebia-highcharts.js"></script>
    <script type="text/javascript" src="/js/sockjs-0.2.1.min.js"></script>
    <script type="text/javascript" src='/js/vertxbus.js'></script>

    <script type="text/javascript">

        var hits=0;
        <!-- TODO create the event bus -->
        var evtBus = new vertx.EventBus(window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/monitor-evt-bus');

        evtBus.onclose = function() {console.log('event bus closed')}

        evtBus.onopen = function() {
            console.log('event bus opened');

            // initialize the chart (the 20th first points)
            time = (new Date()).getTime();
            countChart.series[0].data=[]
            evtBus.send('xke.cache', {action: 'count', collection: 'cache'}, function(message) {
                for (i = -19; i <= 0; i++) {
                    countChart.series[0].addPoint({
                        x: time + i * 2000,
                        y: message["count"]
                        });
                }
            });

            // register handler for get
            evtBus.registerHandler('mongostat.count', function(message) {
                var x=(new Date()).getTime(),
                    y=message.count;
                countChart.series[0].addPoint([x,y], true, true);
            });

            // TODO request the hit count on 'mongostat.l2.hit' topic and add the count in hitsContainerL2 element

        }

    </script>

</head>
<body>

<div id="countContainer" style="width: 800px; height: 300px; margin: 0 auto"></div>
<div style="font-size: 24px; font-family: Courier New; font-weight: bold;width: 600px; margin: 0 ;">hits level1: <span id="hitsContainerL1"></span></div>
<div style="font-size: 24px; font-family: Courier New; font-weight: bold;width: 600px; margin: 0 ;">hits level2: <span id="hitsContainerL2"></span></div>
</body>
</html>